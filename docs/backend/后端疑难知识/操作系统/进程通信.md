# 进程通信（IPC,Inter-Process Communication）

进程用户空间是相互独立的，一般而言是不能相互访问的。但很多情况下进程间需要互相通信，来完成系统的某项功能。进程通过与内核及其它进程之间的互相通信来协调它们的行为。

## 进程通信的应用场景

- 数据传输：一个进程需要将它的数据发送给另一个进程，发送的数据量在一个字节到几兆字节之间。
- 共享数据：多个进程想要操作共享数据，一个进程对共享数据的修改，别的进程应该立刻看到。
- 通知事件：一个进程需要向另一个或一组进程发送消息，通知它（它们）发生了某种事件（如进程终止时要通知父进程）。
- 资源共享：多个进程之间共享同样的资源。为了作到这一点，需要内核提供锁和同步机制。
- 进程控制：有些进程希望完全控制另一个进程的执行（如Debug进程），此时控制进程希望能够拦截另一个进程的所有陷入和异常，并能够及时知道它的状态改变。

## 进程通信的方式

**管道( pipe )：**

管道包括三种:

- 普通管道PIPE： 通常有两种限制,一是单工,只能单向传输;二是只能在父子或者兄弟进程间使用.
- 流管道s_pipe: 去除了第一种限制,为半双工，只能在父子或兄弟进程间使用，可以双向传输.
- 命名管道:name_pipe：去除了第二种限制,可以在许多并不相关的进程之间进行通讯.

**信号量( semophore ) ：**

- 信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。

**消息队列( message queue ) ：**

- 消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

**信号 ( sinal ) ：**

- 信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。

**共享内存( shared memory ) ：**

- 共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号两，配合使用，来实现进程间的同步和通信。

**套接字( socket ) ：**

- 套解口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。



## 面试题：讲讲进程通信

因为有时候想要在**两个进程之间实现数据传输、资源共享、通知事件（例如进程终止时会通知父进程）以及进程控制（debug进程可以控制其他进程的执行）**，但是我们知道进程组织的时候是一个结构体，**进程与进程之间是相互独立的，有独立的虚拟地址空间**，所以进程间通信是很难的，所以**内核给我们提供一份公共资源让两进程都能访问就可以实现通信**了，由此就引出了我们的几大进程间通信的方式：管道、消息队列、共享内存、信号量。接下来就是分别描述这几个方式。

### 管道（内核提供，单工，自同步（快的适应慢的）机制）

**管道：**Linux下一切皆文件这我们必须牢记，所以管道就是一份文件，进程A能看到进程B也能够看到，同时进程A往管道中写数据进程B就可以从另一端读数据了。管道又分为匿名管道和命名管道，匿名管道用pipe()创建，只能用于有亲缘关系（fork出来的进程）的进程间通信，而命名管道则是用于任意进程。最后我们可以说一下

命名管道的特点：1、适用于任意进程2、面向字节流3、半双工通信（当然想要实现全双工通信，只要两个管道就可以了）4、生命周期随进程5、内置同步与互斥机制。

### 消息队列

**消息队列：**说白了消息队列就是一个链表，进程A可以向队列中写数据（写满则不能写了，因为消息队列是固定的），队列中有数据了进程B就可以开始读数据了，读完了数据就不能读了（这也就能说明消息队列面向数据报）

消息队列的特点：1、适用于任意进程2、面向数据报3、全双工通信（只要进程有读写权限就可以双向通信）4、生命周期随内核5、内置同步与互斥机制。

### 共享内存

**共享内存：**共享内存就是一块内存，我们知道内存有随机访问的优势，所以共享内存就成为了进程间通信最快的方式。具体通信原理就是这一块物理内存在映射的时候会映射不同的虚拟地址空间，不同的虚拟地址空间就代表着不同的进程那么就可以让多个进程都看到这块内存，然后进行读写操作。

共享内存的特点：1、适用于任意进程2、全双工通信3、生命周期随内核

### 信号量

**信号量：**信号量准确的来说就没有通信，他可以理解为是一个计数器加上等待队列，它主要侧重了同步于互斥，因为有时候多个进程同时访问临界资源就会产生死锁，那么就需要信号量记录可申请的资源的数量，每申请一次信号量减1，用完释放就加1，等待队列就是资源被申请完了（信号量为0），在申请就会信号量<0，那么此时就会将进程加入等待队列，一旦有资源释放，就可以立马申请到。

信号量的特点就是同步与互斥！！！

### 信号

**信号：**信号也应该属于进程间通信的一种方式，为什么呢？因为进程控制也是进程间通信的目的之一，那一个进程给另外一个进程发送个9号信号就可以杀死这个进程。

网络套接字：用于不同机器间的进程通信。