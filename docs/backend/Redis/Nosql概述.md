# NoSql 概述

## 什么是NoSql

NoSql = Not Only SQL（不仅仅是SQL）

泛指非关系型数据库的，随着web2.0互联网的诞生！传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区！暴露出来很多难以克服的问题，NOSQL在当今大数据环境下发展的十分迅速，Redis是发展最快的，而且是我们当下必须要掌握

很多的数据类型用户的个人信息，社交网络，地理位置，流媒体。这些数据类型的存储不需要一个固定的格式，不需要多余的操作就可以横向扩展，即用Map<String,Object>键值对即可完成控制。



## 为什么要用NoSQL

用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！

这时候我们就需要使用 NOSQL数据库的，NoSql可以很好的处理以上的情况！

### Nosql特点

解耦！

1、方便扩展（数据之间没有关系，很好扩展！）

2、大数据量高性能（Redis一秒写8万次，读取11万，NOSQL的缓存记录级，是一种细粒度的缓存，性能会比较高！）

3、数据类型是多样型的！（不需要事先设计数据库！如果是数据量十分大的表，很多人就无法设计了！）

4、传统 RDBMS（关系型）和 NOSQL

```
传统的 RDBMS
- 结构化组织
- SQL
- 数据和关系都存在单独的表中
- 操作语言，数据定义语言
- 严格一致性
- 事务
```

```
Nosql
- 不仅仅是数据
- 没有固定的查询语言
- 键值对存储，列存储，文档存储，图形数据库（社交关系）
- 最终一致性
- CAP定理和BASE（异地多活）
- 高性能，高可用，高可扩
- 。。。
```

**大数据时代的3V+3高**

大数据时代的3V

- 海量Volume
- 多样Variety
- 实时Velocity

互联网需求的3高

- 高并发
- 高可扩（随时可以水平拆分，机器不够，可以随时加入一台服务器）
- 高性能

## 数据库发展史

**1、单机MySQL的时代**（读写一库）

![image-20200527203112410](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200527203112410.png)

90年代，一个基本的网站访问量一般不会太大，单个数据库完全足够

那个时候，更多的去使用静态网页Htm~服务器根本没有太大的压力

思考一下，这种情况下：整个网站的瓶颈是什么？

1. 数据量如果太大、一个机器放不下了！
2. 数据的索引（B+Tree），当数据量很多时（300万条数据就必须建立索引），一个机器内存也放不下
3. 访问量（读写混合），一个 服务器承受不了

只要你开始出现以上的三种情况之一，那么你就必须要优化！



**2、Memcached（缓存）+MySQL+垂直拆分（读写分离）**

网站80%的情况都是在读，每次都要去査询数据库的话就十分的麻烦！

用户A和用户B访问用的是同一条sql，频繁进行查表是没有意义的，所以说我们希望减轻数据的压力，我们可以使用缓存来保证效率。

发展过程：

​	优化数据结构和索引（优化数据库自身）--->文件缓存（IO）----> Memcacahed(当时最热门的技术)

![image-20200527210049234](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200527210049234.png)

用户A和用户B访问用的是同一条sql，频繁进行查表是没有意义的，所以说我们希望减轻数据的压力，我们可以使用缓存来保证效率。



**3、分库分表+水平拆分+MySql集群**

技术和业务在发展的同时，对人的要求也越来越高！

本质：数据库（读，写）

早些年 MyISAM：表锁，十分影响效率！高并发下就会出现严重的锁问题

转战 innodb：行锁

慢慢的就开始使用分库分表来解决写的压力！MySQL在哪个年代推出了表分区！这个并没有多少公司使用！

MySQL的集群，很好满足哪个年代的所有需求！

![image-20200527210404155](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200527210404155.png)



**4、最近的年代**

MySQL等关系型数据库就不够用了！数据种类很多，变化很快~！

![image-20200527225449279](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200527225449279.png)

<div style="text-align: center;color: #C2C2C4">现代企业的架构示意图</div>

MySQL有的使用它来村粗一些比较大的文件，比如博客，图片！数据库表很大，效率就低了！如果有一种数据库来**专门处理某种数据**，MySQL压力就变得十分小（研究如何处理这些问题！）大数据的IO压力下，表几乎没法更大，无法在1亿数据量的表中再加一列



真正在公司中的实践：NOSQL+ RDBMS一起使用才是最强的。

## 阿里巴巴的架构演进

![image-20200527234310201](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200527234310201.png)



如果你未来相当一个架构师：没有什么是加一层解决不了的！不行就加两层

![image-20200527235752303](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200527235752303.png)



一个商品涉及的数据库和属性

```bash
# 1、商品的基本信息
	名称、价格、商家信息
	关系型数据库就可以解决了！MsQL/orac1e（淘宝早年就去IoE了！-王坚 推荐文章：阿里云的这群疯子）
	淘宝内部的MySQL不是大家用的MySQL，内部自己修改优化
# 2、商品的描述、评论（文字比较多）
	文档型数据库中，MongoDB

# 3、图片
	分布式文件系统 FastDFS
	- 淘宝自己的	    TFs
	- Gooa1e的      GFs
	- Hadoop       HDFS
	- 阿里云的       oss
	
# 4、商品的关键字（搜索）
	- 搜索引擎	solr	elasticSearch
	- ISearch：多隆（阿里巴巴的第一个程序员）#所有牛逼的人都有一段苦逼的岁月！只要像sb一样坚持，终将牛逼
	
# 5、商品热门的波段信息（秒杀）
	- 内存数据库
	- Redis、Tair、Memcached

# 6、商品的交易，外部的支付接口
	- 三方应用
```

要知道，一个简单地网页背后的技术一定不是大家所想的那么简单！

大型互联网应用问题

- 数据类型太多了！
- 数据源繁多，经常重构
- 数据要改造，大面积改造（一条mysql可能需要多张表的改动）

![image-20200528000919465](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200528000919465.png)

![image-20200528000938075](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200528000938075.png)

![image-20200528001122230](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200528001122230.png)

这里以上都是NosαL入门概述，不仅能够提高大家的知识，还可以帮助大家了解大厂的工作内容！



## NoSQL 四大分类



**1、KV键值对（Redis、Tair、memcached）**

- 新浪：Redis
- 美团：Redis+Tair
- 阿里、百度：Redis+ memcached

**2、文档型数据库（bson格式和json一样）**

- MongoDB（一般必须要掌握）
  - MongoDB是一个基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档！
  - MongoDB是一个介于**关系型数据库和非关系型数据中间**的产品！MongoDB是非关系型数据库中功能最丰富，最像关系型数据库的
- ConthDB： 不介绍

![image-20200528002016499](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200528002016499.png)

**3、列存储数据库**

- HBase
- 分布式文件系统

**4、图关系数据库**

不是放图的，而是放关系的

![image-20200528002331622](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200528002331622.png)

- 他不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐！
- Neo4j，InfoGrid

### 总结

如下表格

| 分类                | 举例                           | 典型应用场景                                                 | 数据模型                                    | 优点                                                         | 缺点                                                         |
| ------------------- | ------------------------------ | ------------------------------------------------------------ | ------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 键值（key-value）   | Redis, Voldemort, Oracle BDB   | 内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。 | Key指向vaue的键值对，通常用hash table来实现 | 查找速度快                                                   | 数据无结构化，通常只被当作字符串或者二进制数据               |
| 列存储数据库        | HBase                          | 分布式的文件系统                                             | 以列簇式存储，将同一列数据存在一起          | 查找速度快，可扩展性强，更容易进行分布式扩展                 | 功能相对局限                                                 |
| 文档型数据库        | CouchDB,MongoDb                | Web应用（与 Key-Value类似，vaue是结构化的，不同的是数据库能够了解vaue的内容） | Key-Value对应的键值对，value为结构化数据    | 数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构 | 查询性能不高，而且缺乏统一的查询语法                         |
| 图形（Graph数据库） | Neo4J, InfoGrid,Infinite Graph | 社交网络，推荐系统等。专注于构建关系图谱                     | 图结构                                      | 利用图结构相关算法。比如最短路径寻址，N度关系查找等          | 很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方式 |

## NoSql和关系型数据库区别

关系型数据库存取慢

![image-20200422125355785](https://gitee.com/zero049/MyNoteImages/raw/master/image-20200422125355785.png)

**优点：**

1）成本：nosql数据库简单易部署，基本都是开源软件，不需要像使用oracle那样花费大量成本购买使用，相比关系型数据库价格便宜。

2）查询速度：nosql数据库将数据存储于缓存之中，关系型数据库将数据存储在硬盘中，自然查询速度远不及nosql数据库。

3）存储数据的格式：nosql的存储格式是key，value形式、文档形式、图片形式等等，所以可以存储基础类型以及对象或者是集合等各种格式，而数据库则只支持基础类型。

4）扩展性：关系型数据库有类似join这样的多表查询机制的限制导致扩展很艰难。

**缺点：**

1）维护的工具和资料有限，因为nosql是属于新的技术，不能和关系型数据库10几年的技术同日而语。

2）不提供对sql的支持，如果不支持sql这样的工业标准，将产生一定用户的学习和使用成本。

3）不提供关系型数据库对事务的处理。

非关系型数据库的优势：

1）性能NOSQL是基于键值对的，可以想象成表中的主键和值的对应关系，而且不需要经过SQL层的解析，所以性能非常高。

2）可扩展性同样也是因为基于键值对，数据之间没有耦合性，所以非常容易水平扩展。

关系型数据库的优势：

1）复杂查询可以用SQL语句方便的在一个表以及多个表之间做非常复杂的数据查询。

2）事务支持使得对于安全性能很高的数据访问要求得以实现。对于这两类数据库，对方的优势就是自己的弱势，反之亦然。